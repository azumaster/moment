webpackJsonp([3],{226:function(module,exports,__webpack_require__){var Component=__webpack_require__(21)(null,__webpack_require__(264),null,null);module.exports=Component.exports},227:function(module,exports,__webpack_require__){var Component=__webpack_require__(21)(__webpack_require__(249),__webpack_require__(272),null,null);module.exports=Component.exports},249:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _crypto=__webpack_require__(92),_crypto2=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(_crypto);exports.default={name:"userList",data:function(){var _this2=this;return{params:{page:1,size:20},roleList:[{value:2,label:"部门管理员"},{value:3,label:"专员"}],paging:{current:1,total:0},userColumn:[{title:"姓名",key:"userName"},{title:"注册手机号码",key:"userMobile"},{title:"角色",key:"userRole"},{title:"创建时间",key:"createdAt"},{title:"用户状态",key:"status"},{title:"操作",key:"action",render:function(h,params){var btns=[],userName=params.row.userName,userType=params.row.userType,userStatus=params.row.userStatus,currentUserName=_this2.$store.state.user.userName,currentUserType=_this2.$store.state.user.userType;return userName===currentUserName?btns=[h("Button",{props:{type:"info",size:"small"},on:{click:function(){_this2.edit(params.index,1)}}},"编辑")]:userType>currentUserType&&(2==userStatus?btns=[h("Button",{props:{type:"info",size:"small"},style:{marginRight:"5px"},on:{click:function(){_this2.edit(params.index)}}},"编辑"),h("Button",{props:{type:"success",size:"small"},on:{click:function(){_this2.changeUserStatus(params.index,1)}}},"恢复")]:1==userStatus&&(btns=[h("Button",{props:{type:"info",size:"small"},style:{marginRight:"5px"},on:{click:function(){_this2.edit(params.index)}}},"编辑"),h("Button",{props:{type:"error",size:"small"},on:{click:function(){_this2.changeUserStatus(params.index,2)}}},"拉黑")])),h("div",btns)}}],userList:[],showAdd:!1,userBasic:{data:{mobile:"",password:"",type:2},length:{maxMobile:11}},showEdit:!1,noCurrent:!0,userBasicEdit:{data:{name:"",mobile:"",type:2,id:""},length:{maxMobile:11}}}},methods:{getUserList:function(){var _this=this;this.$Loading.start(),this.$ajax({method:"get",url:"/user/getUserList",params:_this.params}).then(function(res){if(0==res.data.code){var roles=["0","超级管理员","部门管理员","专员"],status=["0","正常","已拉黑"],list=res.data.data.list;list.map(function(user){user.userRole=roles[user.userType],user.status=status[user.userStatus]}),_this.userList=list,_this.paging.current=res.data.data.current,_this.paging.total=res.data.data.total}else _this.$Message.error(res.data.message);_this.$Loading.finish()}).catch(function(){_this.$Message.error("小Mo开小差去了，请稍后再试~"),_this.$Loading.error()})},confirmAdd:function(){var mobile=this.userBasic.data.mobile,type=this.userBasic.data.type,password=this.userBasic.data.password,_this=this;password=_crypto2.default.createHmac("sha1","azumar").update(password).digest().toString("base64"),this.$ajax({method:"post",url:"/user/addUser",data:{mobile:mobile,type:type,pwd:password}}).then(function(res){0==res.data.code?(_this.$Message.success(res.data.message),_this.getUserList()):_this.$Message.error(res.data.message)}).catch(function(){_this.$Message.error("小Mo开小差去了，请稍后再试~")})},edit:function(index,type){var user=this.userList[index];this.userBasicEdit.data.mobile=user.userMobile,this.userBasicEdit.data.name=user.userName,this.userBasicEdit.data.type=user.userType,this.userBasicEdit.data.id=user.userId,this.noCurrent=!type,this.showEdit=!0},confirmEdit:function(){var _this=this,data={};data.id=this.userBasicEdit.data.id,this.userBasicEdit.data.mobile&&(data.mobile=this.userBasicEdit.data.mobile),this.userBasicEdit.data.name&&(data.name=this.userBasicEdit.data.name),this.userBasicEdit.data.type&&(data.type=this.userBasicEdit.data.type),this.$ajax({method:"post",url:"/user/editUser",data:data}).then(function(res){0==res.data.code?(_this.$Message.success(res.data.message),_this.getUserList()):_this.$Message.error(res.data.message)}).catch(function(){_this.$Message.error("小Mo开小差去了，请稍后再试~")})},changeUserStatus:function(index,status){var id=this.userList[index].userId,_this=this,name=this.userList[index].userName,title=void 0,content=void 0,text=void 0;1==status?(title="恢复用户状态？",text="恢复",content="你是否要恢复 ["+name+"] 的正常登录状态？恢复后，该用户可以原角色权限使用本系统。"):2==status&&(title="拉黑该用户？",text="拉黑",content="你是否要拉黑 ["+name+"] ？拉黑后，该用户将无法登录本系统，但仍会保留该用户的资料信息。"),this.$Modal.confirm({title:title,content:content,okText:text,loading:!0,onOk:function(){this.$ajax({method:"post",url:"/user/updateUserStatus",data:{id:id,status:status}}).then(function(res){0==res.data.code?(_this.$Message.success("操作成功！"),_this.getUserList()):_this.$Message.error(res.data.message)}).catch(function(){_this.$Message.error("小Mo开小差去了，请稍后再试~")}),_this.$Modal.remove()}})}},created:function(){this.getUserList()}}},264:function(module,exports){module.exports={render:function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("section",{staticClass:"moment-page"},[_c("router-view")],1)},staticRenderFns:[]}},272:function(module,exports){module.exports={render:function(){var _vm=this,_h=_vm.$createElement,_c=_vm._self._c||_h;return _c("div",{attrs:{id:"userList"}},[_c("div",{staticClass:"page-header"},[_c("Button",{attrs:{type:"primary",size:"large",icon:"ios-plus-outline"},on:{click:function($event){_vm.showAdd=!0}}},[_vm._v("添加新用户")])],1),_vm._v(" "),_c("div",{staticClass:"page-table"},[_c("Table",{attrs:{border:"",columns:_vm.userColumn,data:_vm.userList}}),_vm._v(" "),_c("Page",{staticStyle:{margin:"20px 0"},attrs:{total:_vm.paging.total,current:_vm.paging.current,"page-size":_vm.params.size},on:{"on-change":_vm.changePage}})],1),_vm._v(" "),_c("Modal",{attrs:{title:"添加新用户"},on:{"on-ok":_vm.confirmAdd},model:{value:_vm.showAdd,callback:function($$v){_vm.showAdd=$$v},expression:"showAdd"}},[_c("Form",{attrs:{model:_vm.userBasic,"label-width":80}},[_c("FormItem",{attrs:{label:"手机号码"}},[_c("Input",{attrs:{maxlength:_vm.userBasic.length.maxMobile,placeholder:"请输入初始手机号码"},model:{value:_vm.userBasic.data.mobile,callback:function($$v){_vm.userBasic.data.mobile=$$v},expression:"userBasic.data.mobile"}})],1),_vm._v(" "),_c("FormItem",{attrs:{label:"初始密码"}},[_c("Input",{attrs:{type:"password",placeholder:"请设置该账户的初始密码"},model:{value:_vm.userBasic.data.password,callback:function($$v){_vm.userBasic.data.password=$$v},expression:"userBasic.data.password"}})],1),_vm._v(" "),_c("FormItem",{attrs:{label:"指定角色"}},[_c("Select",{attrs:{placeholder:"请选择该用户指定的角色"},model:{value:_vm.userBasic.data.type,callback:function($$v){_vm.userBasic.data.type=$$v},expression:"userBasic.data.type"}},_vm._l(_vm.roleList,function(role){return _c("Option",{key:role.value,attrs:{value:role.value}},[_vm._v(_vm._s(role.label))])}))],1)],1)],1),_vm._v(" "),_c("Modal",{attrs:{title:"编辑该用户"},on:{"on-ok":_vm.confirmEdit},model:{value:_vm.showEdit,callback:function($$v){_vm.showEdit=$$v},expression:"showEdit"}},[_c("Form",{attrs:{model:_vm.userBasicEdit,"label-width":80}},[_c("FormItem",{attrs:{label:"用户名"}},[_c("Input",{attrs:{placeholder:"请输入用户名"},model:{value:_vm.userBasicEdit.data.name,callback:function($$v){_vm.userBasicEdit.data.name=$$v},expression:"userBasicEdit.data.name"}})],1),_vm._v(" "),_c("FormItem",{attrs:{label:"手机号码"}},[_c("Input",{attrs:{maxlength:_vm.userBasicEdit.length.maxMobile,placeholder:"请输入手机号码"},model:{value:_vm.userBasicEdit.data.mobile,callback:function($$v){_vm.userBasicEdit.data.mobile=$$v},expression:"userBasicEdit.data.mobile"}})],1),_vm._v(" "),_vm.noCurrent?_c("FormItem",{attrs:{label:"指定角色"}},[_c("Select",{attrs:{placeholder:"请选择该用户指定的角色"},model:{value:_vm.userBasicEdit.data.type,callback:function($$v){_vm.userBasicEdit.data.type=$$v},expression:"userBasicEdit.data.type"}},_vm._l(_vm.roleList,function(role){return _c("Option",{key:role.value,attrs:{value:role.value}},[_vm._v(_vm._s(role.label))])}))],1):_vm._e()],1)],1)],1)},staticRenderFns:[]}}});